# File Dictionary

This file contains a list of all non-ignored files in the repository and a brief description of their purpose.

*   `Changelog.md`: This file documents all notable changes to the project, following the "Keep a Changelog" format. It tracks version history, including fixes, changes, and removals, and adheres to semantic versioning.
*   `LICENSE`: This file contains the MIT License for the project, a permissive free software license that allows for broad reuse with minimal restrictions. The main condition is the inclusion of the copyright and permission notices in all distributions.
*   `PrivacyPolicy.md`: This file outlines the application's data practices, emphasizing a strict "no data collection" policy. All data processing, including camera and sensor data, occurs on-device for core functionality. An anonymous network call is made for version checking.
*   `README.md`: This file provides a comprehensive overview of the Cue d'Etat project, a billiards aiming assistant for Android. It details the app's features, including a live camera overlay, protractor mode, bank shot calculator, and spin control. The README also explains the technical implementation, known quirks, and future plans.
*   `TODO.md`: This file tracks upcoming features, high-priority tasks, and refactoring needs for the Cue d'Etat project. It includes items like implementing an interactive tutorial, integrating spin effects, creating a calibration database, and optimizing performance.
*   `backup_for_ai.ps1`: This is a PowerShell script for Windows users to create a backup of the project. It can generate either a full backup containing the content of all non-ignored files or a file tree listing all non-ignored files and directories. The script is configured to exclude build artifacts, dependencies, and binary files to create a clean, text-based backup.
*   `build.gradle.kts`: This is the top-level build file for the Gradle project. It defines the versions of the Android Gradle Plugin, Kotlin Android plugin, Dagger Hilt plugin, and Kotlin Kapt plugin that are used across all modules.
*   `gradle.properties`: This file configures project-wide Gradle settings. It sets up the build environment by specifying JVM arguments for memory allocation, enabling AndroidX, setting the Kotlin code style, and enabling build optimizations like the configuration cache and non-transitive R classes. It also contains various flags that control the behavior of the Android Gradle Plugin and the R8 shrinker.
*   `settings.gradle.kts`: This is the settings file for the Gradle build. It configures the plugin and dependency resolution management for the project, defining the repositories for plugins and dependencies. It also sets the root project name to "CueDetat" and includes the `:app` and `:Dev_Guide` modules in the build.
*   `app/build.gradle.kts`: This is the module-level Gradle build file for the main application (`:app`). It configures the Android application build, including the application ID, SDK versions, and build types like 'release' with minification enabled. It applies necessary plugins for Kotlin, Hilt (dependency injection), and Jetpack Compose. The file also declares all the project's dependencies, such as AndroidX libraries, CameraX for camera functionality, Retrofit for networking, ML Kit for computer vision, and LiquidFun for physics simulations.
*   `app/proguard-rules.pro`: This file defines the configuration for R8, Android's tool for code shrinking, optimization, and obfuscation. It contains a set of `-keep` rules that prevent R8 from removing or renaming essential classes, methods, and fields that are used at runtime but may appear to be unused to the static analyzer. This is critical for the proper functioning of libraries that rely on reflection or specific naming conventions, such as Jetpack Compose, Hilt, Retrofit, ML Kit, and OpenCV.
*   `Dev_Guide/Prompts.txt`: This file contains meta-instructions for an AI assistant working on the codebase. It includes directives on how the AI should behave, such as providing full code modifications, asking for clarification, and suggesting changes. It also contains initial prompts for the AI to become an expert on the project by studying the `Dev_Guide` and the source code.
*   `Dev_Guide/00_Overview/00_Introduction.md`: This file serves as the introduction to the Cue d'Etat Development Guide. It establishes that the guide contains mandatory project specifications and architectural principles. It also defines a document hierarchy to resolve any potential conflicts in the documentation, ensuring consistency and clarity.
*   `Dev_Guide/00_Overview/01_ProjectPersona.md`: This document defines the persona for the application's user-facing text. It specifies a cynical, witty, and slightly condescending tone, and provides guidelines for the voice and content of warning messages, UI labels, and menu items to ensure consistency with this persona.
*   `Dev_Guide/00_Overview/02_ConductCode.md`: This document outlines the expected conduct for an AI developer working on the project. It mandates that the AI should be direct, competent, generate complete code, and adhere to the project's cynical persona when creating user-facing text.
*   `Dev_Guide/00_Overview/03_CoreConcepts.md`: This file establishes a consistent vocabulary for the project. It defines core concepts like the "Logical Plane" (an abstract 2D coordinate system for geometry), the "Screen Plane" (the device's physical screen), and the "Perspective Transformation" that projects the logical plane onto the screen. It also provides a glossary of key on-screen elements like `ActualCueBall`, `TargetBall`, and `GhostCueBall`.
*   `Dev_Guide/01_Architecture/01_Mandates.md`: This document lays out the fundamental, non-negotiable architectural rules for the application. Key mandates include strict adherence to Unidirectional Data Flow (UDF), the ViewModel's role as an orchestrator, the Single Responsibility Principle, and the necessity of holistic model updates and atomic refactoring.
*   `Dev_Guide/01_Architecture/02_Architecture.md`: This file provides a detailed overview of the Model-View-Intent (MVI) architecture and the strict Unidirectional Data Flow (UDF) it enforces. It breaks down the core components (View, ViewModel, State Reducer, Use Cases, State), explains their roles, and outlines the precise data flow from user interaction to UI re-rendering. It also specifies the rendering pipeline's transformation order.
*   `Dev_Guide/01_Architecture/03_StateManagement.md`: This document details the `CueDetatState` data class, the single, immutable source of truth for the application's UI. It provides an overview of the state's key properties, categorized into sections such as View & Dimensions, Core Logical Model, UI & Mode Controls, Sensor & Perspective Data, and Derived State (calculated by `UpdateStateUseCase`).
*   `Dev_Guide/01_Architecture/04_Manifest.md`: This document specifies the required configurations for the `AndroidManifest.xml` and `proguard-rules.pro` files. It details the necessary permissions, features, and application/activity setup for the manifest, and outlines the mandatory Proguard rules to prevent crashes in release builds by preserving essential classes for libraries like Jetpack Compose, Hilt, and OpenCV.
*   `Dev_Guide/01_Architecture/05_Dependencies.md`: This file specifies the project's build configuration and dependencies. It outlines the project structure, the app module's Gradle configuration (including plugins, SDK versions, and build types), and the essential libraries managed through a `libs.versions.toml` file. Key dependencies include Jetpack, Compose, Hilt, CameraX, Retrofit, computer vision tools (OpenCV, ML Kit), and the LiquidFun physics engine.
*   `Dev_Guide/02_CoreComponents/01_OperationalModes.md`: This file outlines the three distinct user experience modes: Expert Mode, offering the full feature set; Beginner Mode, a simplified version with locked and free-aim sub-modes to guide new users; and Hater Mode, an interactive, cynical "Magic 8-Ball" that responds to a device shake.
*   `Dev_Guide/02_CoreComponents/02_Perspective_and_3D.md`: This file establishes the core principles for the 2D-to-3D perspective transformation. It outlines four key "doctrines" to ensure visual consistency: the correct order of transformations (2D then 3D), the decoupling of zoom from perspective, the unified sizing of 3D objects, and the proper calculation for lifting table rails in the 3D view.
*   `Dev_Guide/02_CoreComponents/03_Table.md`: This file appears to be a duplicate of `02_Perspective_and_3D.md`. Based on its title, it should define the logical `Table` component, including its size, rotation, visibility, and how its visual elements (rails, diamonds) are rendered. However, it currently contains the same content as the perspective and 3D transformation document.
*   `Dev_Guide/02_CoreComponents/04_Balls.md`: This file defines the logical objects that represent pool balls in the application. It distinguishes between data models (`ProtractorUnit`, `OnPlaneBall`) and the roles they play (`Target Ball`, `Ghost Cue Ball`, `Actual Cue Ball`, `Banking Ball`). The document details the purpose, model, and rendering style for each role, and specifies their default positions.
*   `Dev_Guide/02_CoreComponents/05_Lines.md`: This file defines the line components used for aiming and visualization, such as the `ShotGuideLine` and `TangentLines`. It specifies their rendering rules, including color changes for warnings and pocketing, as well as the logic for fading lines that extend into open space.
*   `Dev_Guide/02_CoreComponents/06_CvModule.md`: This file specifies the integration of the local `:opencv` module, which contains pre-compiled native libraries and their Java/Kotlin wrappers from the official OpenCV Android SDK. It details the module's structure, build configuration, and the application-level integration required in `MyApplication.kt` to load the native library at runtime.
*   `app/src/main/AndroidManifest.xml`: This is the central configuration file for the Android application. It defines the app's essential properties, requests necessary permissions like `CAMERA` and `INTERNET`, declares the use of camera hardware, and sets up the application class for Hilt initialization. It also defines the main activity as the app's entry point, specifies the app's theme, and sets the launcher icons.
*   `app/src/main/java/com/hereliesaz/cuedetat/MainActivity.kt`: This is the main entry point for the application. It manages the main UI and its lifecycle, handles camera permissions, and orchestrates the navigation between the app's different experience modes (Expert, Beginner, Hater). It also displays the splash screen on the first launch and observes single events from the ViewModel.
*   `app/src/main/java/com/hereliesaz/cuedetat/MyApplication.kt`: This file defines the custom `Application` class. Annotated with `@HiltAndroidApp`, it serves as the entry point for Hilt's dependency injection and is responsible for loading the native OpenCV library at runtime.
*   `app/src/main/java/com/hereliesaz/cuedetat/data/CalibrationAnalyzer.kt`: This file defines a custom `ImageAnalysis.Analyzer` that processes camera frames for calibration. It converts each `ImageProxy` to a `Mat` object and passes it to the `CalibrationViewModel` for processing.
*   `app/src/main/java/com/hereliesaz/cuedetat/data/GithubRepository.kt`: This file defines a repository that fetches the latest release version name from the project's GitHub page. It uses a `GithubApi` interface to make the network call and returns the tag name as a string.
*   `app/src/main/java/com/hereliesaz/cuedetat/data/SensorRepository.kt`: This file defines a repository that provides a smoothed flow of the device's orientation data (yaw, pitch, and roll) using the `TYPE_ROTATION_VECTOR` sensor. It applies an Exponential Moving Average (EMA) filter to the raw sensor data to reduce jitter and provides the orientation data as a `Flow<FullOrientation>`.
*   `app/src/main/java/com/hereliesaz/cuedetat/data/ShakeDetector.kt`: This file defines a `ShakeDetector` class that uses the device's accelerometer to detect a shake gesture. It calculates the speed of the device's movement and emits a `Unit` value to a `Flow` when the speed exceeds a certain threshold.
*   `app/src/main/java/com/hereliesaz/cuedetat/data/UserPreferencesRepository.kt`: This file defines a repository that manages the app's persistent user preferences using Jetpack DataStore. It is responsible for serializing and deserializing the application's state (`CueDetatState`) and camera calibration data (`cameraMatrix`, `distCoeffs`) to and from JSON format, providing `Flow`s to observe changes to these settings.
*   `app/src/main/java/com/hereliesaz/cuedetat/data/VisionAnalyzer.kt`: This file defines a custom `ImageAnalysis.Analyzer` that processes camera frames for computer vision tasks. It receives the application's UI state and, based on the current `experienceMode`, either converts the `ImageProxy` to a `Bitmap` for "Hater Mode" or passes the image to the `VisionRepository` for processing.
*   `app/src/main/java/com/hereliesaz/cuedetat/data/VisionData.kt`: This file defines a `VisionData` data class that holds the results of computer vision processing. It includes lists of detected balls, HSV color data, bounding boxes, a binary mask for debugging, and information about the source image.
*   `app/src/main/java/com/hereliesaz/cuedetat/data/VisionRepository.kt`: This file defines a repository that processes camera frames for computer vision tasks. It uses a `genericObjectDetector` to detect objects in the image, refines the detected ball centers using either contour or Hough circle detection, and then transforms the ball coordinates from image space to logical space. The results are emitted as a `Flow<VisionData>`.
*   `app/src/main/java/com/hereliesaz/cuedetat/di/AppModule.kt`: This file defines a Dagger Hilt module that provides singleton instances of various dependencies used throughout the application. These include the `GithubApi`, `UserPreferencesRepository`, a generic `ObjectDetector`, a `ShakeDetector`, and a `Gson` instance.
*   `app/src/main/java/com/hereliesaz/cuedetat/di/Qualifiers.kt`: This file defines two custom qualifiers, `@GenericDetector` and `@CustomDetector`, which are used to distinguish between different implementations of the same dependency type when using Hilt for dependency injection.
*   `app/src/main/java/com/hereliesaz/cuedetat/domain/AGENTS.md`: This file provides guidelines for working with the `domain` layer of the application. It emphasizes that the `CueDetatState` data class is the single, immutable source of truth and outlines the key principles of immutability and the single source of truth. It also categorizes the state properties and specifies that all state modifications must be performed within a `StateReducer`.
*   `app/src/main/java/com/hereliesaz/cuedetat/domain/CalculateBankShot.kt`: This file defines a `CalculateBankShot` use case that calculates the path of a multi-rail bank shot. It takes the current application state as input and returns a `BankShotResult` containing the calculated path and the index of the pocketed pocket, if any.
*   `app/src/main/java/com/hereliesaz/cuedetat/domain/CalculateSpinPaths.kt`: This file defines a `CalculateSpinPaths` use case that calculates the curved path of the cue ball after impact when English (sidespin) is applied. It generates a BÃ©zier curve based on the spin angle and magnitude, and if the table is visible, it calculates the reflection of the path off the rails.
*   `app/src/main/java/com/hereliesaz/cuedetat/domain/ReducerUtils.kt`: This file defines a `ReducerUtils` class that provides utility functions for the state reducers. It includes functions to get the default positions for the cue and target balls, and a function to snap any balls that are outside the table boundaries back to their default positions.
*   `app/src/main/java/com/hereliesaz/cuedetat/domain/StateReducer.kt`: This file defines the single, unified `stateReducer` function for the entire application. It takes the current state and an event, and returns a new state. The `stateReducer` delegates the actual state modification to a set of specialized sub-reducers, organized by the type of event they handle (e.g., gestures, UI actions, system events).
*   `app/src/main/java/com/hereliesaz/cuedetat/domain/UiModel.kt`: This file defines the core data structures for the application's UI. It includes the `CueDetatState` data class, which represents the single, immutable source of truth for the entire application, and the `MainScreenEvent` sealed class, which defines all the possible user interactions and system events that can modify the state.
*   `app/src/main/java/com/hereliesaz/cuedetat/domain/UpdateStateUseCase.kt`: This file defines a `UpdateStateUseCase` that is responsible for calculating all the derived data in the application's state. It takes the current state and an `UpdateType` and returns a new state with the updated derived data, including perspective matrices, aiming lines, bank shots, and spin paths.
*   `app/src/main/java/com/hereliesaz/cuedetat/domain/WarningManager.kt`: This file defines a `WarningManager` class that is responsible for displaying and dismissing warning messages. It cycles through a list of warnings and displays each one for a fixed duration before automatically dismissing it.
*   `app/src/main/java/com/hereliesaz/cuedetat/domain/reducers/ActionReducer.kt`: This file defines the `reduceAction` function, a sub-reducer responsible for handling the `MainScreenEvent.Reset` event. It resets the application's state to its default values, including ball positions, zoom, and rotation, while saving the current state for a potential restore.
*   `app/src/main/java/com/hereliesaz/cuedetat/domain/reducers/AdvancedOptionsReducer.kt`: This file defines the `reduceAdvancedOptionsAction` function, a sub-reducer that handles events related to the advanced options dialog. This includes toggling the dialog's visibility, managing the computer vision mask, entering and exiting test modes, and updating the parameters for the Hough and Canny edge detection algorithms.
*   `app/src/main/java/com/hereliesaz/cuedetat/domain/reducers/ControlReducer.kt`: This file defines the `reduceControlAction` function, a sub-reducer that handles events related to user controls. This includes zoom, table rotation, luminance and glow adjustments, panning the view, and applying the quick align feature.
*   `app/src/main/java/com/hereliesaz/cuedetat/domain/reducers/CvReducer.kt`: This file defines the `reduceCvAction` function, a sub-reducer that handles events related to computer vision. This includes updating the `visionData` in the state, locking and unlocking the HSV color for object detection, and clearing the color sample point.
*   `app/src/main/java/com/hereliesaz/cuedetat/domain/reducers/GestureReducer.kt`: This file defines the `GestureReducer`, a sub-reducer that handles all gesture-related events. It manages the application's `interactionMode` based on the user's touch input and updates the state accordingly. This includes moving and rotating the protractor, moving the cue and obstacle balls, and aiming bank shots.
*   `app/src/main/java/com/hereliesaz/cuedetat/domain/reducers/ObstacleReducer.kt`: This file defines the `reduceObstacleAction` function, a sub-reducer that handles the `MainScreenEvent.AddObstacleBall` event. It finds the next available placement for a new obstacle ball, creates a new `OnPlaneBall` at that position, and adds it to the list of obstacle balls in the state.
*   `app/src/main/java/com/hereliesaz/cuedetat/domain/reducers/SnapReducer.kt`: This file defines the `SnapReducer`, a sub-reducer responsible for managing the list of `SnapCandidate`s. It processes the `visionData` to identify and track potential snap targets, updating their confirmation status based on how long they have been continuously detected.
*   `app/src/main/java/com/hereliesaz/cuedetat/domain/reducers/SpinReducer.kt`: This file defines the `reduceSpinAction` function, a sub-reducer that handles events related to the spin control. This includes applying spin, ending the spin selection, dragging the spin control, and clearing the spin state.
*   `app/src/main/java/com/hereliesaz/cuedetat/domain/reducers/SystemReducer.kt`: This file defines the `reduceSystemAction` function, a sub-reducer that handles system-level events. This includes handling screen size changes, updating the device orientation, setting the color scheme, and displaying warnings. It is also responsible for creating the initial state of the application when it is first launched.
*   `app/src/main/java/com/hereliesaz/cuedetat/domain/reducers/ToggleReducer.kt`: This file defines the `reduceToggleAction` function, a sub-reducer that handles events related to toggling UI elements and application settings. This includes managing the visibility of menus, dialogs, and the camera feed, as well as cycling through table sizes, switching between distance units, and locking the screen orientation.
*   `app/src/main/java/com/hereliesaz/cuedetat/domain/reducers/TutorialReducer.kt`: This file defines the `reduceTutorialAction` function, a sub-reducer that handles events related to the interactive tutorial. This includes starting the tutorial, advancing to the next step, ending the tutorial, and updating the highlight alpha for the tutorial overlay.
*   `app/src/main/java/com/hereliesaz/cuedetat/network/GithubApi.kt`: This file defines the Retrofit interface for the GitHub API. It includes the `GithubApi` interface, which defines the endpoint for fetching the latest release of a repository, and the `GithubRelease` data class, which represents the relevant fields from the API response.
*   `app/src/main/java/com/hereliesaz/cuedetat/ui/CameraPreview.kt`: This file defines a Jetpack Compose composable that displays a live camera preview. It uses `AndroidView` to wrap a `PreviewView` from the CameraX library, and it handles the lifecycle of the camera by binding it to the `LocalLifecycleOwner`.
*   `app/src/main/java/com/hereliesaz/cuedetat/ui/MainLayout.kt`: This file defines the main layout for the application's UI. It uses a `Box` to layer various UI components, including the main content, top controls, zoom controls, a table rotation slider, and the spin control. It also includes overlays for warnings and the tutorial, as well as dialogs for advanced options, luminance adjustment, and table size selection.
*   `app/src/main/java/com/hereliesaz/cuedetat/ui/MainViewModel.kt`: This file defines the `MainViewModel`, which is the central orchestrator of the application. It receives UI events, forwards them to the `stateReducer`, and exposes the resulting state as a `StateFlow`. It also subscribes to data flows from the `SensorRepository` and `VisionRepository`, and uses the `UpdateStateUseCase` to calculate derived state.
*   `app/src/main/java/com/hereliesaz/cuedetat/ui/MenuAction.kt`: This file defines a sealed class that represents all possible user actions originating from UI menus or buttons. This provides a clean, type-safe way to pass events from the UI to the ViewModel.
*   `app/src/main/java/com/hereliesaz/cuedetat/ui/Modifiers.kt`: This file defines a custom `Modifier` extension function called `vertical()` that rotates a composable by -90 degrees and swaps its width and height constraints. This is used to display composables vertically.
*   `app/src/main/java/com/hereliesaz/cuedetat/ui/ProtractorScreen.kt`: This file defines the `ProtractorScreen` composable, which is the main screen for the application's "Expert" and "Beginner" modes. It displays the camera preview in the background and overlays the appropriate UI based on the current state, such as the `CalibrationScreen`, the `QuickAlignScreen`, or the `MainLayout` with the `ProtractorOverlay`.
*   `app/src/main/java/com/hereliesaz/cuedetat/ui/VerticalSlider.kt`: This file defines a `VerticalSlider` composable, which is a wrapper around the `Slider` composable from Material 3. It uses the custom `vertical()` modifier to display the slider vertically.
*   `app/src/main/java/com/hereliesaz/cuedetat/ui/ZoomMapping.kt`: This file defines a `ZoomMapping` object that provides functions for converting between a linear slider position and an exponential zoom factor. It also defines the minimum and maximum zoom levels for the different experience modes.
